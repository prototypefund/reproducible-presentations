<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/black.css" id="theme">

  <style type="text/css">
  li {
    margin-top: 28px !important;
    list-style-type: none !important;
  }
  ul ul li {
    margin-top: 16px !important;
  }
  * {
    text-transform: none !important;
  }
  a {
    color: inherit !important;
  }
  code {
    font-size: 90% !important;
  }
  .text-center {
    text-align: center;
  }

  .reveal section img {
    border: none;
    box-shadow: none;
    background-color: inherit;
  }
  .reveal pre code {
    overflow: inherit !important;
    max-height: inherit !important;
    padding: 0 0 20px 20px;
  }

  .thanks {
    width: 100%;
    margin-top: 120px !important;
    border-radius: 5px;
    background-color: white;
  }

  .thanks img {
    border: 0;
  }

  .text-left {
    text-align: left;
  }

  .text-right {
    text-align: right;
  }

  .pull-left {
    float: left;
  }

  .pull-right {
    float: right;
  }

  section.title h4 {
    font-weight: normal;
    font-size: 80%;
  }

  table.hash-example td {
    border: none;
    padding-right: 2em;
    padding-bottom: 0.8em;
  }

  table.hash-example tr.good code {
    color: lightgreen;
  }

  table.hash-example tr.bad code {
    color: #ff2222;
  }

  table.involved {
    margin-top: 2em;
  }

  table.involved td {
    border: none;
    padding-left: 3em;
    padding-bottom: 0.4em;
  }
  .pics td {
    border-bottom: 0 !important;
    padding: 0 15px 0 15px !important;
  }

  .pics img {
    height: 190px;
  }
  </style>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <script>
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  document.getElementsByTagName('head')[0].appendChild( link );
</script>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section class="title" data-background-color="white">
        <p style="text-align: center; margin-top: 90px"><img src="images/r-b-logo.png"></p>
        <br>
        <br>
        <h4 class="pull-left text-left">
          Chris Lamb
          <br>
          @lolamby
          <br>
          chris@reproducible-builds.org
        </h4>
        <h4 class="pull-right text-right">
          New York University
          <br>
          Brooklyn, NY
          <br>
          16th October 2018
        </h4>
      </section>

      <section></section>
      <section></section>
      <section data-transition="none"></section>

      <section data-background-color="white" data-transition="none">
      </section>

      <section class="title" data-background="images/lamby.png" data-background-size="10%" data-background-position="90% 10%">
        <p>Debian Project Leader 2017—</p>
        <p class="fragment">OpenSource.org board director</p>
        <p class="fragment">Free software developer for 10+ years</p>
        <p class="fragment">Freelance software developer</p>
      </section>

      <section></section>

      <section data-background-color="white" data-transition="none">
        <img src="images/sudoku.png" style="width: 60%;">
      </section>

      <section data-background-color="white" data-transition="none">
        <img src="images/wget.png">
      </section>

      <section data-background="images/ZeroCoolOS.jpg">
      </section>

      <section>
        <img src="images/lute.jpg" style="width: 40%; margin-right: 1em;">
        <img src="images/gamba.jpg" style="width: 40%">
      </section>

      <section></section>

      <section>
        <h2>Three developers&hellip;</h2>
      </section>

      <!--
      I want to tell you three stories about three developers.
      -->

      <section></section>

      <section data-background="images/story/6.jpg">
        <h1>Alice</h1>
        <!--
         - Alice Writes a free software used by a lot of people
         - She also releases binaries online
         - She also has a sister who has a deep secret
         - Blackmailed to include a backdoor in the binaries
        -->
      </section>
      <section data-background-color="#f2f6f9">
        <img src="images/story/browser.png">
      </section>
      <section data-background="images/story/4.jpg"></section>
      <section data-background="images/story/7.jpg"></section>
      <section data-background-color="#f2f6f9">
        <img src="images/story/browser2.png">
      </section>

      <section></section>

      <section data-background="images/story/1.jpg">
        <h1>Bob</h1>
        <!--
         - This is Bob's computer
         - Developer for an Linux distribution
         - He is very good about computer security
         - Doesn't know his servers have been compromised
         - Servers are generating compromised binaries that are now part of a distriubution
         - Bob does not know
        -->
      </section>
      <section data-background="images/story/5.jpg"></section>
      <section data-background="images/story/8.jpg"></section>
      <section data-background="images/story/5b.jpg"></section>

      <section></section>

      <section data-background="images/story/10.jpg">
        <h1 style="margin-right: -800px">&larr; Carol</h1>
        <!--
         - This is Eve.
         - No, *this* is Eve, that is actually Carol
         - Evil maid
         - Inserting USB stick; computer now infected; all
         - Computer
        -->
      </section>
      <section data-background="images/story/3.jpg">
        <h1 style="margin-right: -700px">Eve &rarr;</h1>
      </section>
      <section data-background="images/story/9.jpg"></section>
      <section data-background="images/story/11.jpg"></section>

      <section data-background-color="white" data-transition="none">
        <img src="images/story/11a.png">
      </section>

      <section></section>

      <section data-background="images/install.jpg" data-background-size="80%" data-background-color="black">
        <h2>General problem</h2>
        <br>
        <p class="fragment">Can view source code for malicious flaws</p>
        <p class="fragment">But users install pre-compiled packages</p>
        <br>
        <p class="fragment text-center" style="font-weight: bold;"><u>Can we trust the compilation process?</u></p>
      </section>

      <section></section>

      <!--
      <section>
        <ul>
          <li>Developers</li>
          <li>Build/server farms</li>
          <li>Developers' machines</li>
        </ul>
      </section>
      -->

      <section></section>

      <section data-background="images/screenshots/15.png"></section>
      <section data-background="images/screenshots/11.png"></section>
      <section data-background="images/screenshots/01.png"></section>
      <section data-background="images/screenshots/05.png"></section>
      <section data-background="images/screenshots/02.png"></section>
      <section data-background="images/screenshots/07.png"></section>
      <section data-background="images/screenshots/08.png"></section>
      <section data-background="images/screenshots/09.png"></section>
      <section data-background="images/screenshots/10.png"></section>
      <section data-background="images/screenshots/12.png"></section>
      <section data-background="images/screenshots/13.png"></section>
      <section data-background="images/screenshots/14.png"></section>
      <section data-background="images/screenshots/evilmaid.png"></section>
      <section data-background="images/screenshots/calgary.png"></section>
      <section data-background="images/screenshots/06.png"></section>

      <section></section>
      <section></section>
      <section></section>
      <section></section>

      <section class="text-left">
        <h2>Solution?</h2>
        <br>
        <p class="fragment">1. Start with the same source</p>
        <p class="fragment">2. Ensure builds always have <u>identical results</u></p>
        <p class="fragment">3. Compare results</p>
      </section>

      <section data-transition="none">
        <img src="images/sharing/01.png">
      </section>
      <section data-transition="none">
        <img src="images/sharing/02.png">
      </section>
      <section data-transition="none">
        <img src="images/sharing/03.png">
      </section>

      <section class="text-left">
        <h2>How does this help?</h2>
        <br>
        <p class="fragment text-left">Alice &rarr; Blackmail will be uncovered</p>
        <p class="fragment text-left">Bob &rarr; Compromise detected</p>
        <p class="fragment text-left">Carol &rarr; Tampered laptop will be discovered</p>
        <br>
        <p class="fragment text-center">
          <big><strong style="color: lightgreen;">Reduces incentive to attack in the first place</strong></big>
        </p>
      </section>

      <section class="text-left">
        <p class="fragment">"Builds with the same dependencies"... ✖</p>
        <p class="fragment">"Reliable" builds... ✖</p>
        <br>
        <p class="fragment text-center">
          <big><strong style="color: lightgreen;">Identical build results</strong></big>
        </p>
      </section>


      <section>
        <h2>Wait&hellip;</h2>
      </section>

      <section>
        <ul>
          <li class="fragment">Dictionary/hash/database ordering</li>
          <li class="fragment">Parallelism in builds</li>
          <li class="fragment">Timestamps</li>
          <li class="fragment">Build paths</li>
          <li class="fragment">Non-deterministic file ordering</li>
          <li class="fragment">Users, groups, <code>umask</code>, environment variables, etc.</li>
        </ul>
      </section>

      <section>
        <h2>Other advantages?</h2>
      </section>

      <section>
        <ul>
        <ul>
          <li class="fragment">Minimal diffs on "deliberate" changes</li>
          <li class="fragment">Cache ratio &mdash; save time, money &amp; CO<sub>2</sub></li>
          <li class="fragment">Remove build-dependencies</li>
          <li class="fragment">Finds bugs!</li>
        </ul>
        </ul>
      </section>

      <section>
      </section>

      <section>
        <h3>Predictable OpenID secret</h3>
        <br>

<pre class="fragment"><code># Build.PL
$build-&gt;config_data(OpenIDConsumerSecret=&gt;int(<u>1e15*rand()</u>));
</code></pre>

        <div class="fragment">
          <pre><code># /usr/share/perl5/GBrowse/ConfigData.pm
{
 'OpenIDConsumerSecret' =&gt; '<u>639098210478536</u>',
 'cgibin' =&gt; '/usr/lib/cgi-bin/gbrowse',
 'conf' =&gt; '/etc/gbrowse',
 [..]
},
</code></pre>

          <ul>
            <li>Every installation of this build shares the same secret.</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Random characters in manpages?</h3>
        <br>

        <pre class="fragment"><code>-This manual page documents the usageoof WikipediaFS.
+This manual page documents the usage of WikipediaFS.
</code></pre>

        <pre class="fragment"><code>memcpy(&amp;buf[1], &amp;buf[2], strlen(buf)-1);</code></pre>

        <pre class="fragment"><code>memcpy(3): The memory areas must not overlap</code></pre>

        <pre class="fragment"><code>- memcpy(&amp;buf[1], &amp;buf[2], strlen(buf)-1);
+ memmove(&amp;buf[1], &amp;buf[2], strlen(buf)-1);
</code></pre>
      </section>

      <section>
        <h3>Fails to build 0.46% of the time?</h3>
        <br>

<pre class="fragment"><code>x = f(u('abc'), 16)
y = f(u('abc'), 16)
self.assertEqual(sorted(set(x)), [u('a'), u('b'), u('c')])
</code></pre>

<pre class="fragment"><code>AssertionError: Lists differ: [u'a', u'b'] != [u'a', u'b', u'c']</code></pre>

        <ul>
          <li class="fragment">
            (<sub>3</sub>C<sub>2</sub>)*(2/3)<sup>16</sup> &ndash; (<sub>3</sub>C<sub>1</sub>)*(1/3)<sup>16</sup> =~ 0.46%
          </li>
        </ul>
      </section>

      <section></section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2>Debian &amp; Reproducible Builds</h2>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2 class="fragment">
          "Torture test"
        </h2>

        <ul class="fragment">
          <ul>
            <li>Time &amp; date</li>
            <li>Hostname &amp; domain name</li>
            <li>Filesystem (<code>disorderfs</code>)</li>
            <li>Timezone &amp; locale</li>
            <li><code>uid</code> &amp; <code>gid</code></li>
            <li>Kernel &amp; CPU type</li>
          </ul>
        </ul>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <table>
          <tr><td>First rebuild in 2013</td><td>24% packages reproducible</td></tr>
          <tr><td>March 2018</td><td>93% packages reproducible</td></tr>
        </table>
      </section>

      <!-- wget -Oimages/status.png https://tests.reproducible-builds.org/debian/unstable/amd64/stats_pkg_state.png -->
      <section data-background="images/status.png">
        &nbsp;
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2><code>isdebianreproducibleyet.com</code></h2>
      </section>

      <section>
        <h2>Beyond Debian&hellip;</h2>
        <ul>
          <li class="fragment">coreboot, Fedora, LEDE, OpenWRT, NetBSD, FreeBSD, Archlinux, Qubes, F-Droid, NixOS, Guix, Meson, etc.</li>
          <li class="fragment">Other projects using "Debian"'s testing framework</li>
          <li class="fragment">Reproducible Builds summits (Athens, Berlin)</li>
        </ul>
      </section>

      <section></section>
      <section></section>

      <section>
        <pre style="font-size: 85%;"><code>
<span style="color: white;"># diff -urNad file1 file2</span>
--- file1  2017-06-18 12:37:03.179186661 +0800
+++ file2  2017-06-18 12:37:04.811193648 +0800
@@ -1 +1 @@
<span style="color: #ff6666;">-This is the first file.</span>
<span style="color: lightgreen;">+This is the second file.</span>
        </code></pre>
      </section>

      <section>
        <img src="images/bindiff.png">
      </section>

      <section>
        <img src="images/cat.png">
      </section>

      <section data-background-color="white" data-transition="none">
        <img src="images/diffoscope-homepage.png">
        <p><code>https://diffoscope.org/</code></p>
      </section>

      <section>
        <pre style="font-size: 57%;"><code>
├── aspell-de_20131206-5_all.deb
│   ├── metadata
│   │  rw-r--r-- 0/0      4 Jun 11 16:19 2014 debian-binary
│   │ <span style="color: #ff6666;">-rw-r--r-- 0/0   2893 Jun 11 16:19 2014 control.tar.gz</span>
│   │ <span style="color: #ff6666;">-rw-r--r-- 0/0 329600 Jun 11 16:19 2014 data.tar.xz</span>
│   │ <span style="color: lightgreen;">+rw-r--r-- 0/0   2875 Jun 11 16:19 2014 control.tar.gz</span>
│   │ <span style="color: lightgreen;">+rw-r--r-- 0/0 329596 Jun 11 16:19 2014 data.tar.xz</span>
│   ├── control.tar.gz
│   │   ├── control.tar
│   │   │   ├── md5sums
│   │   │   │┄ <span style="color: #ff6666;">Files in package differ</span>
│   ├── data.tar.xz
│   │   ├── data.tar
│   │   │   ├── ./usr/lib/aspell/de_affix.dat
│   │   │   │  #
│   │   │   │ <span style="color: #ff6666;">-# Version: 20131206 (build 20150801)</span>
│   │   │   │ <span style="color: lightgreen;">+# Version: 20131206 (build 20150802)</span>
│   │   │   │  #
│   │   │   ├── ./usr/share/aspell/de-common.cwl.gz
│   │   │   │   ├── metadata
│   │   │   │   │ <span style="color: #ff6666;">-gzip compressed data, last modified: Sat Aug  1 18:21:34 2015</span>
│   │   │   │   │ <span style="color: lightgreen;">+gzip compressed data, last modified: Sat Aug  1 18:24:36 2015</span>
        </code></pre>
      </section>

      <section data-background-color="white">
        <h2>HTML output</h2>
        <img src="images/demos/sqlite3.png">
      </section>
      <section>
        <p style="font-size: 75%">Android APK files, Android boot images, Ar(1) archives, Berkeley DB database files, Bzip2 archives, Character/block devices, ColorSync colour profiles (.icc), Coreboot CBFS filesystem images, Cpio archives, Dalvik .dex files, Debian .buildinfo files, Debian .changes files, Debian source packages (.dsc), Device Tree Compiler blob files, Directories, ELF binaries, Ext2/ext3/ext4/btrfs filesystems, FreeDesktop Fontconfig cache files, FreePascal files (.ppu), Gettext message catalogues, GHC Haskell .hi files, GIF image files, Git repositories, GNU R database files (.rdb), GNU R Rscript files (.rds), Gnumeric spreadsheets, Gzipped files, ISO 9660 CD images, Java .class files, JavaScript files, JPEG images, JSON files, LLVM IR bitcode files, MacOS binaries, Microsoft Windows icon files, Microsoft Word .docx files, Mono 'Portable Executable' files, Ogg Vorbis audio files, OpenOffice .odt files, OpenSSH public keys, OpenWRT package archives (.ipk), PDF documents, PGP signed/encrypted messages, PNG images, PostScript documents, RPM archives, Rust object files (.deflate), SQLite databases, SquashFS filesystems, Statically-linked binaries, Symlinks, Tape archives (.tar), Tcpdump capture files (.pcap), Text files, TrueType font files, XML binary schemas (.xsb), XML files, XZ compressed files, etc.</p>
      </section>

      <section data-background-color="#110022">
       <img src="images/trydiffoscope.png">
       <h2><code>try.diffoscope.org</code></h2>
      </section>

      <section>
        <ul>
          <li class="fragment">Show differences in security uploads</li>
          <li class="fragment">diffoscope ≠ definition of reproducible!</li>
          <li class="fragment">Binary blobs (eg. images for routers / IoT devices)</li>
        </ul>
      </section>

      <section></section>

      <section>
        <h2>What's left to do?</h2>
      </section>


      <section>
        <h3>Source code</h3>
        <br>

        <p class="fragment">Programming errors</p>
        <p class="fragment">Backdoors / obfusticated code</p>
        <p class="fragment">Weak algorithms</p>
        <p class="fragment">Code with "testing" modes</p>
      </section>

      <section class="text-left">
        <code><pre style="font-size: 80%">
$ apt install python-pywt-doc
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  python-pywt-doc
0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.
Need to get 102 kB of archives.
After this operation, 978 kB of additional disk space will be used.
<b>WARNING: The following packages are not reproducible!</b>
<b>  python-pywt-doc</b>
<b><u>Install these packages anyway? [y/N]</u></b>
        </pre></code>
      </section>

      <section></section>

      <section class="text-left">
        <p class="fragment">Toolchain fixes (GCC, Go, R)</p>
        <p class="fragment">Infrastructure changes</p>
        <p class="fragment">Improving developer tools</p>
        <p class="fragment">Mandating Debian packages be reproducible?</p>
        <p class="fragment">Defeating <em>Trusting Trust</em>&hellip;?</p>
      </section>

      <section>
        <h2>Get involved!</h2>
        <table class="involved">
          <tr class="fragment"><td>Visit:</td><td><code><a href="https://reproducible-builds.org/">reproducible-builds.org</a></code></td></tr>
          <tr class="fragment"><td>Follow:</td><td><strong>@ReproBuilds</strong> on Twitter</td></tr>
          <tr class="fragment"><td>Join:</td><td><code>#reproducible-builds</code> (OFTC)</td></tr>
        </table>

      </section>

      <section></section>

      <section>
        <br>

        <h1 style="font-size: 1.5em;"><em>Thanks!</em></h1>
        <br>
        <br>
        <br>
        <br>

        <h4 class="pull-left text-left" style="font-size: 90%;">
          <a href="http://twitter.com/lolamby">@lolamby</a>
          <br>
          <a href="mailto:lamby@debian.org">lamby@debian.org</a>
        </h4>
        <h4 class="pull-right text-right" style="font-size: 90%;">
          <a href="https://chris-lamb.co.uk/">chris-lamb.co.uk</a>
          <br>
          <a href="https://reproducible-builds.org/">reproducible-builds.org</a>
        </h4>
        <p style="text-align: center; margin-top: 130px"><img src="images/favicon.png"></p>
      </section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
  <script>
    Reveal.initialize({
      controls: false,
      progress: false,
      history: true,
      keyboard: {
        13: 'next',
        38: 'next',
         9: 'prev',
        40: 'prev'
      }
    });
  </script>
</body>
</html>
