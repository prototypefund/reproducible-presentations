<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/black.css" id="theme">

  <style type="text/css">
  li {
    margin-top: 28px !important;
    list-style-type: none !important;
  }
  ul ul li {
    margin-top: 16px !important;
  }
  * {
    text-transform: none !important;
  }
  a {
    color: inherit !important;
  }
  code {
    font-size: 90% !important;
  }
  .text-center {
    text-align: center;
  }

  .reveal section img {
    border: none;
    box-shadow: none;
    background-color: inherit;
  }
  .reveal pre code {
    overflow: inherit !important;
    max-height: inherit !important;
    padding: 0 0 20px 20px;
  }

  .thanks {
    width: 100%;
    margin-top: 120px !important;
    border-radius: 5px;
    background-color: white;
  }

  .thanks img {
    border: 0;
  }

  .text-left {
    text-align: left;
  }

  .text-right {
    text-align: right;
  }

  .pull-left {
    float: left;
  }

  .pull-right {
    float: right;
  }

  section.title h4 {
    font-weight: normal;
    font-size: 80%;
  }

  table.hash-example td {
    border: none;
    padding-right: 2em;
    padding-bottom: 0.8em;
  }

  table.hash-example tr.good code {
    color: lightgreen;
  }

  table.hash-example tr.bad code {
    color: red;
  }

  table.involved {
    margin-top: 2em;
  }

  table.involved td {
    border: none;
    padding-left: 3em;
    padding-bottom: 0.4em;
  }
  .pics td {
    border-bottom: 0 !important;
    padding: 0 15px 0 15px !important;
  }

  .pics img {
    height: 190px;
  }
  </style>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <script>
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  document.getElementsByTagName('head')[0].appendChild( link );
</script>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section class="title" data-background="images/debian_logo.png" data-background-size="6%" data-background-position="50% 15%">
        <br>
        <br>
        <br>
        <br>
        <h3>
          You think you're not a target?<br>A tale of 3 developers&hellip;
        </h3>
        <br>
        <br>
        <h4 class="pull-left text-left">
          Chris Lamb
          <br>
          Debian Project Leader 2017
          <br>
          @lolamby
        </h4>
        <h4 class="pull-right text-right">
          Freenode #live
          <br>
          Bristol, United Kingdom
          <br>
          28 October 2017
        </h4>
      </section>

      <section></section>
      <section></section>

      <section>
        <h2>My name is&hellip;</h2>
      </section>

      <section class="title" data-background="images/lamby.png" data-background-size="10%" data-background-position="90% 10%">
        <p class="fragment">Free software developer for 10+ years</p>
        <p class="fragment">Freelance software developer</p>
        <p class="fragment">Debian Project Leader 2017</p>
      </section>

      <section></section>

      <section data-background="images/ZeroCoolOS.jpg">
      </section>

      <section data-background-color="white">
        <img src="images/wget.png">
      </section>

      <section data-background-color="white">
        <img src="images/sudoku.png" style="width: 60%;">
      </section>

      <section>
        <pre>
https://chris-lamb.co.uk/posts/free-software-activities-in-september-2015
https://chris-lamb.co.uk/posts/free-software-activities-in-october-2015
https://chris-lamb.co.uk/posts/free-software-activities-in-november-2015
https://chris-lamb.co.uk/posts/free-software-activities-in-december-2015
https://chris-lamb.co.uk/posts/free-software-activities-in-january-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-february-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-march-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-april-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-may-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-june-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-july-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-august-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-september-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-october-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-november-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-december-2016
https://chris-lamb.co.uk/posts/free-software-activities-in-january-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-february-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-march-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-april-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-may-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-june-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-july-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-august-2017
https://chris-lamb.co.uk/posts/free-software-activities-in-september-2017
        </pre>
      </section>

      <section>
        <img src="images/lute.jpg" style="width: 40%; margin-right: 1em;">
        <img src="images/gamba.jpg" style="width: 40%">
      </section>

      <section></section>

      <section>
        <h2>Three developers&hellip;</h2>
      </section>

      <!--
      I want to tell you three stories about three developers.
      -->

      <section></section>

      <section data-background="images/story/6.jpg">
        <h1>Alice</h1>
        <!--
         - Alice Writes a free software used by a lot of people
         - She also releases binaries online
         - She also has a sister who has a deep secret
         - Blackmailed to include a backdoor in the binaries
        -->
      </section>
      <section data-background="images/story/4.jpg"></section>
      <section data-background="images/story/7.jpg"></section>

      <section data-background="images/story/1.jpg">
        <h1>Bob</h1>
        <!--
         - This is Bob's computer
         - Developer for an Linux distribution
         - He is very good about computer security
         - Doesn't know his servers have been compromised
         - Servers are generating compromised binaries that are now part of a distriubution
         - Bob does not know
        -->
      </section>
      <section data-background="images/story/5.jpg"></section>
      <section data-background="images/story/8.jpg"></section>

      <section data-background="images/story/10.jpg">
        <h1>Eve</h1>
        <!--
         - This is Eve.
         - No, *this* is Eve
         - Evil maid
         - Inserting USB stick; computer now infected; all
         - Computer
        -->
      </section>
      <section data-background="images/story/3.jpg">
        <h1>Eve</h1>
      </section>
      <section data-background="images/story/9.jpg"></section>
      <section data-background="images/story/11.jpg"></section>

      <section></section>

      <section data-background="images/install.jpg" data-background-size="80%" data-background-color="black">
        <h2>The problem</h2>
        <br>
        <p class="fragment">Can view source code for malicious flaws</p>
        <p class="fragment">But users install pre-compiled packages</p>
        <p class="fragment text-center">Can we trust the compilation process?</p>
      </section>

      <section></section>

      <!--
      <section>
        <ul>
          <li>Developers</li>
          <li>Build/server farms</li>
          <li>Developers' machines</li>
        </ul>
      </section>
      -->

      <section></section>

      <section data-background="images/screenshots/01.png"></section>
      <section data-background="images/screenshots/02.png"></section>
      <section data-background="images/screenshots/03.png"></section>
      <section data-background="images/screenshots/05.png"></section>
      <section data-background="images/screenshots/07.png"></section>
      <section data-background="images/screenshots/08.png"></section>
      <section data-background="images/screenshots/09.png"></section>
      <section data-background="images/screenshots/10.png"></section>
      <section data-background="images/screenshots/11.png"></section>
      <section data-background="images/screenshots/12.png"></section>
      <section data-background="images/screenshots/13.png"></section>
      <section data-background="images/screenshots/14.png"></section>
      <section data-background="images/screenshots/15.png"></section>
      <section data-background="images/screenshots/evilmaid.png"></section>
      <section data-background="images/screenshots/calgary.png"></section>
      <section data-background="images/screenshots/06.png"></section>
      <section data-background="images/screenshots/nhs.png"></section>

      <section></section>
      <section></section>
      <section></section>
      <section></section>


      <!--
      <section>
        <p class="fragment">Compiled by a malicious actor</p>
        <p class="fragment">Compiled with a compromised compiler</p>
      </section>
      -->

      <section class="text-left">
        <h2>The solution?</h2>

        <br>

        <p class="fragment">1. Ensure build always has identical results</p>
        <p class="fragment">2. Multiple parties compare build results</p>
        <br>
        <p class="fragment">
          <big><strong style="color: lightgreen;">Attacker must infect everybody simultaneously</strong></big>
        </p>
      </section>

      <section>
        <h3 style="line-height: 130%;">
          &ldquo;Reproducible&rdquo; builds allows verification that no flaws
          have been introduced during the compilation&nbsp;process
        </h3>
      </section>


      <section></section>

      <section class="text-left">
        <p class="fragment">Not just "builds with the same depedencies"...</p>
        <p class="fragment">Not just "reliable" builds...</p>
        <br>
        <p class="fragment">
          <big><strong style="color: lightgreen;">Identical build results</strong></big>
        </p>
      </section>

      <section>
        <code># sha1sum ./my-binary</code>
        <br>
        <br>
        <br>

        <table class="hash-example">
          <tr class="fragment good">
            <td>Alice</td>
            <td><code>7a482b984883990bd4ab2ac5985630886cc252c</code></td>
          </tr>
          <tr class="fragment good">
            <td>Bob</td>
            <td><code>7a482b984883990bd4ab2ac5985630886cc252c</code></td>
          </tr>
          <tr class="fragment bad">
            <td>Carol</td>
            <td><code>d0f65b7de7a49e818b8095538d3a0f783cc9c27</code></td>
          </tr>
        </table>
      </section>

      <!--
      <section>
        <p style="line-height: 1.8em; font-style: italic;">
          A build is <strong>reproducible</strong> if given the same <em>source
          code</em>, <em>build environment and build instructions</em>, any
          party can recreate bit-by-bit identical copies of all specified
          artifacts.
        </p>
        <br>
        <br>
        <h4><code>reproducible-builds.org/docs/definition</code></h4>
      </section>
      -->

      <section>
        <h2>Wait, software isn't reproducible&nbsp;already?</h2>
      </section>

      <section>
        <ul>
          <li class="fragment">Timestamps</li>
          <li class="fragment">Timezones &amp; locales</li>
          <li class="fragment">Dictionary/hash/database ordering</li>
          <li class="fragment">Build paths</li>
          <li class="fragment">Users, groups, <code>umask</code>, environment variables</li>
          <li class="fragment">Build parallelism</li>
          <li class="fragment">Non-deterministic file ordering</li>
        </ul>
      </section>

      <section>
        <h2>Technical advantages</h2>
      </section>

      <section>
        <ul>
        <ul>
          <li class="fragment">Easier to test changes &mdash; minimal diffs</li>
          <li class="fragment">Detect accidentally corrupted build environments</li>
          <li class="fragment">Faster to build &mdash; save time, money &amp; CO<sub>2</sub></li>
          <li class="fragment">Finds bugs!</li>
        </ul>
        </ul>
      </section>

      <section>
      </section>


      <section>
        <h3>Random characters in manpages</h3>

        <pre class="fragment"><code>-This manual page documents the usageoof WikipediaFS.
+This manual page documents the usage of WikipediaFS.
</code></pre>

        <pre class="fragment"><code>memcpy(&amp;buf[1], &amp;buf[2], strlen(buf)-1);</code></pre>

        <pre class="fragment"><code>memcpy(3): The memory areas must not overlap</code></pre>

        <ul>
          <li class="fragment">"<code> n\\011</code>" &rarr; "<code>\111</code>" &rarr; maps to capital "I"</li>
        </ul>

        <pre class="fragment"><code>- memcpy(&amp;buf[1], &amp;buf[2], strlen(buf)-1);
+ memmove(&amp;buf[1], &amp;buf[2], strlen(buf)-1);
</code></pre>

        <p class="bug-link fragment">
          <a href="https://bugs.debian.org/842635">#842635 (docbook2man)</a>
        </p>
      </section>

      <section>
        <h3>Fails to build 0.46% of the time</h3>

<pre class="fragment"><code>x = f(u('abc'), 16)
y = f(u('abc'), 16)
self.assertEqual(sorted(set(x)), [u('a'), u('b'), u('c')])
</code></pre>

<pre class="fragment"><code>AssertionError: Lists differ: [u'a', u'b'] != [u'a', u'b', u'c']</code></pre>

        <ul>
          <li class="fragment">
            (<sub>3</sub>C<sub>2</sub>)*(2/3)<sup>16</sup> &ndash; (<sub>3</sub>C<sub>1</sub>)*(1/3)<sup>16</sup> =~ 0.46%
          </li>
        </ul>

        <p class="fragment" style="margin-top: 1em;">
          <a href="https://bugs.debian.org/844233">#844233 (python-passlib)</a>
        </p>
      </section>

      <section>
        <h3>Predictable OpenID secret</h3>

<pre class="fragment"><code># Build.PL
$build-&gt;config_data(OpenIDConsumerSecret=&gt;int(1e15*rand()));
</code></pre>

        <div class="fragment">
          <pre><code># /usr/share/perl5/GBrowse/ConfigData.pm
{
 'OpenIDConsumerSecret' =&gt; '639098210478536',
 'cgibin' =&gt; '/usr/lib/cgi-bin/gbrowse',
 'conf' =&gt; '/etc/gbrowse',
 [..]
},
</code></pre>

          <ul>
            <li>Every installation shares the same secret!</li>
          </ul>
        </div>

        <p class="fragment">
          <a href="https://bugs.debian.org/833885">#833885 (gbrowse)</a>
        </p>
      </section>

      <section></section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2>Debian &amp; reproducible builds</h2>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2 class="fragment">
          Test framework
        </h2>

        <ul class="fragment">
          <ul>
            <li>Time &amp; date</li>
            <li>Hostname &amp; domain name</li>
            <li>Filesystem (<code>disorderfs</code>)</li>
            <li>Timezone &amp; locale</li>
            <li><code>uid</code> &amp; <code>gid</code></li>
            <li>Kernel &amp; CPU type</li>
          </ul>
        </ul>
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <table>
          <tr><td>First rebuild in 2013</td><td>24% packages reproducible</td></tr>
          <tr><td>October 2017</td><td>93% packages reproducible</td></tr>
        </table>
      </section>

      <!-- wget -Oimages/status.png https://tests.reproducible-builds.org/debian/unstable/amd64/stats_pkg_state.png -->
      <section data-background="images/status.png">
        &nbsp;
      </section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <h2><code>isdebianreproducibleyet.com</code></h2>
      </section>

      <section>
        <h2>Beyond Debian&hellip;</h2>
        <ul>
          <li class="fragment">coreboot, Fedora, LEDE, OpenWRT, NetBSD, FreeBSD, Archlinux, Qubes, F-Droid, NixOS, Guix, etc.</li>
          <li class="fragment">Other projects now using Debian's testing framework</li>
          <li class="fragment">Reproducible Builds summits (Athens, Berlin)</li>
          <!-- <li class="fragment">Generic tools (diffoscope, disorderfs, strip-nondeterminism, reprotest, etc.)</li> -->
        </ul>
      </section>

      <section></section>
      <section></section>

      <section>
        <pre style="font-size: 85%;"><code>
<span style="color: grey;"># diff -urNad file1 file2</span>
--- file1  2017-06-18 12:37:03.179186661 +0800
+++ file2  2017-06-18 12:37:04.811193648 +0800
@@ -1 +1 @@
<span style="color: red;">-This is the first file.</span>
<span style="color: lightgreen;">+This is the second file.</span>
        </code></pre>
      </section>

      <section data-background-color="white">
        <img src="images/diffoscope-homepage.png">
        <p><code>https://diffoscope.org/</code></p>
      </section>

      <section>
        <pre style="font-size: 57%;"><code>
├── aspell-de_20131206-5_all.deb
│   ├── metadata
│   │  rw-r--r-- 0/0      4 Jun 11 16:19 2014 debian-binary
│   │ <span style="color: red;">-rw-r--r-- 0/0   2893 Jun 11 16:19 2014 control.tar.gz</span>
│   │ <span style="color: red;">-rw-r--r-- 0/0 329600 Jun 11 16:19 2014 data.tar.xz</span>
│   │ <span style="color: lightgreen;">+rw-r--r-- 0/0   2875 Jun 11 16:19 2014 control.tar.gz</span>
│   │ <span style="color: lightgreen;">+rw-r--r-- 0/0 329596 Jun 11 16:19 2014 data.tar.xz</span>
│   ├── control.tar.gz
│   │   ├── control.tar
│   │   │   ├── md5sums
│   │   │   │┄ <span style="color: red;">Files in package differ</span>
│   ├── data.tar.xz
│   │   ├── data.tar
│   │   │   ├── ./usr/lib/aspell/de_affix.dat
│   │   │   │  #
│   │   │   │ <span style="color: red;">-# Version: 20131206 (build 20150801)</span>
│   │   │   │ <span style="color: lightgreen;">+# Version: 20131206 (build 20150802)</span>
│   │   │   │  #
│   │   │   ├── ./usr/share/aspell/de-common.cwl.gz
│   │   │   │   ├── metadata
│   │   │   │   │ <span style="color: red;">-gzip compressed data, last modified: Sat Aug  1 18:21:34 2015</span>
│   │   │   │   │ <span style="color: lightgreen;">+gzip compressed data, last modified: Sat Aug  1 18:24:36 2015</span>
        </code></pre>
      </section>


      <section>
        <h2><code>try.diffoscope.org</code></h2>
      </section>

      <section></section>

      <!--
      <section>
        <h2>Code provenance</h2>

        <ul>
          <li class="fragment">Medical software</li>
          <li class="fragment">Government software</li>
          <li class="fragment">License compliance</li>
        </ul>
      </section>
      -->

      <section>
        <h2>Future work</h2>
      </section>

      <section class="text-left">
        <p class="fragment">Source code remains vulnerable</p>
        <p class="fragment">Communicating concept to end-users?</p>
        <p class="fragment">Mandating Debian packages be reproducible?</p>
      </section>

      <section>
        <h2>Get involved!</h2>
        <table class="involved">
          <tr class="fragment"><td>Fix:</td><td>Bugs and toolchain issues!</td></tr>
          <tr class="fragment"><td>Follow:</td><td><strong>@ReproBuilds</strong> on Twitter</td></tr>
          <tr class="fragment"><td>Join:</td><td><code>#reproducible-builds</code><br><code>irc.oftc.net</code></td></tr>
          <tr class="fragment"><td>Visit:</td><td><code><a href="https://reproducible-builds.org/">reproducible-builds.org</a></code></td></tr>
        </table>

      </section>

      <section></section>

      <section data-background="images/debian.jpg" data-background-color="black">
        <br>

        <h1 style="font-size: 1.5em;"><em>Thank you!</em></h1>
        <br>
        <br>
        <br>
        <br>
        <br>

        <h4 class="pull-left text-left" style="font-size: 90%;">
          <a href="http://twitter.com/lolamby">@lolamby</a>
          <br>
          <a href="mailto:lamby@debian.org">lamby@debian.org</a>
        </h4>
        <h4 class="pull-right text-right" style="font-size: 90%;">
          <a href="https://chris-lamb.co.uk/">chris-lamb.co.uk</a>
          <br>
          <a href="https://reproducible-builds.org/">reproducible-builds.org</a>
        </h4>
      </section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
  <script>
    Reveal.initialize({
      controls: false,
      progress: false,
      history: true,
      keyboard: {
        13: 'next',
        38: 'next',
         9: 'prev',
        40: 'prev'
      }
    });
  </script>
</body>
</html>
