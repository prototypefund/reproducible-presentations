<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Aiming for bullseye!</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/black.css" id="theme">

  <style type="text/css">
  li {
    margin-top: 28px !important;
    list-style-type: none !important;
  }
  ul ul li {
    margin-top: 16px !important;
  }
  * {
    text-transform: none !important;
  }
  a {
    color: inherit !important;
  }
  code {
    font-size: 90% !important;
  }
  .text-center {
    text-align: center;
  }

  .reveal section img {
    border: none;
    box-shadow: none;
    background-color: inherit;
  }
  .reveal pre code {
    overflow: inherit !important;
    max-height: inherit !important;
    padding: 0 0 20px 20px;
  }

  .thanks {
    width: 100%;
    margin-top: 120px !important;
    border-radius: 5px;
    background-color: white;
  }

  .thanks img {
    border: 0;
  }

  .text-left {
    text-align: left;
  }

  .text-right {
    text-align: right;
  }

  .pull-left {
    float: left;
  }

  .pull-right {
    float: right;
  }

  section h4 {
    font-weight: normal;
    font-size: 80%;
  }

  table.hash-example td {
    border: none;
    padding-right: 2em;
    padding-bottom: 0.8em;
  }

  table.hash-example tr.good code {
    color: lightgreen;
  }

  table.hash-example tr.bad code {
    color: #ff2222;
  }

  table.involved {
    margin-top: 2em;
  }

  table.involved td {
    border: none;
    padding-left: 3em;
    padding-bottom: 0.4em;
  }
  .pics td {
    border-bottom: 0 !important;
    padding: 0 15px 0 15px !important;
  }

  .pics img {
    height: 190px;
  }
  </style>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <script>
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
  document.getElementsByTagName('head')[0].appendChild( link );
</script>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <br>
        <h2>
         Aiming for <em>bullseye</em>!
        </h2>
        <br>
        <img src="images/reprobuilds-display.jpeg" style="height: 160px">
        <br>
        <br>
        <h6>
          Chris Lamb &bull; Holger Levsen<br>
          Vagrant Cascadian
        </h6>
        <img src="images/800px-Debconf19-horizontal.png" style="height: 50px;">
      </section>

      <section>
        <ol>
          <li>Introduction</li>
          <li>Status updates</li>
          <li>Issues in detail</li>
        </ol>
      </section>
      <!--========================================================= -->

      <section></section><section>
        <h1>Introduction</h1>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <p>The problem</p>
        <ol>
          <li>Ignore the name!</li>
          <li>Source code of free software available</li>
          <li>&hellip;most people install pre-compiled binaries</li>
          <li><strong>We have no idea whether they correspond.</strong></li>
        </ol>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Enter reproducible builds:</h3>
        <ol>
          <li>If identical results are always generated from the source&hellip;</li>
          <li>&hellip;multiple parties reach consensus on a "correct" build.</li>
        </ol>
      </section>

      <section>
        <iframe width="1000px" height="500px" src="https://www.youtube.com/embed/PSxm2DbDHG8"></iframe>
      </section>

      <!--========================================================= -->

      <section></section><section>
        <h1>Status updates</h1>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h2>New since DebConf18 Taipei</h2>
      </section>

      <section data-background-color="white">
        <p>New logo</p>
        <img class="fragment" src="images/logo.png" width="584">
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <p>4th Reproducible Builds Summit in Paris</p>
        <img src="images/paris.jpg" width="584">
      </section>

      <section data-background-color="white">
        <img src="images/sfc.png" width="584">
        <p>We are now a Conservancy project</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Other projects</h3>
        <p class="fragment">Arch Linux at ~80% reproducible packages</p>
        <p class="fragment">openSUSE at 93%</p>
        <p class="fragment">openSUSE and Arch Linux now included in tests.reproducible-builds.org database</p>
        <p class="fragment">(&hellip;)</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Other projects (continued)</h3>
        <p class="fragment">Alpine being tested since MiniDebConf Hamburg 2019</p>
        <p class="fragment">NetBSD and FreeBSD base systems at 100% for the base install</p>
        <p class="fragment">Tails 3.3, 3.6.1 &rarr; 100% reproducible ISO images</p>
        <p class="fragment">OpenWrt and coreboot images (most targets)<p>
      </section>


      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Collaboration is great</h3>
        <p>Lots of very nice, unexpected results...</p>
        <img class="fragment" src="images/reprobuilds-display.jpeg" style="height: 300px">
      </section>


      <!-- lamby -->
      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Debian installer images</h3>
        <p class="fragment">Lots of progress this year</p>
        <p class="fragment"><code>mtools</code> (#900409 &amp; #900410)</p>
        <p class="fragment"><code>src: debian-installer</code> (#900918, #920631, #920676, #926242)</p>
        <br>
        <p class="fragment">Status: Pending testing</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>diffoscope</h3>
        <br>
        <p>Recursive and human-readable "diff" &mdash; locates and diagnoses reproducibility issues</p>
      </section>

      <section data-background-color="white">
        <img src="images/diffoscope.png">
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <p><code>195 files changed, 4887 insertions(+), 2065 deletions(-)</code></p>
        <br>
        <p>
          <code>#871244</code>, <code>#888237</code>, <code>#894334</code>, <code>#901757</code>, <code>#901758</code>, <code>#901982</code>, <code>#902369</code>, <code>#903391</code>, <code>#903401</code>, <code>#903444</code>, <code>#903447</code>, <code>#903449</code>, <code>#903565</code>, <code>#904685</code>, <code>#905598</code>, <code>#905885</code>, <code>#906967</code>, <code>#907600</code>, <code>#908072</code>, <code>#908074</code>, <code>#908900</code>, <code>#908991</code>, <code>#913315</code>, <code>#916226</code>, <code>#916353</code>, <code>#920701</code>, <code>#926470</code> &amp; many more&hellip;
        </p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>strip-nondeterminism</h3>
        <br>
        <p>Removes specific non-deterministic results from completed builds.</p>
        <br>
        <p>37 files changed, 275 insertions(+), 452 deletions(-)</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Project website</h3>
        <br>
        <p>New design with better "information architecture"</p>
        <p>Monthy reports</p>
        <p>Added better instructions on how to contribute</p>
      </section>

      <!-- holger -->
      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Debian <em>buster</em></h3>
        <p>"Packages should build reproducibly" added in Debian Policy <code>4.1.0.0</code><p>
      </section>

      <section data-background-color="white">
        <p>Applied and unapplied patches</p>
        <img class="fragment" src="images/stats_bugs_sin_ftbfs_state.png" width="120%">
      </section>

      <!--========================================================= -->

      <section></section><section>
        <h1>Issues in detail</h1>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>What (else) is missing?</h3>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Build Path Variations</h3>
        <p>GCC <code>-fmacro-prefix-map</code> and <code>-ffile-prefix-map</code></p>
        <pre class="fragment">#include &lt;stdio.h&gt;
int main() {
  fprintf(stderr, "error at %s line %l", __FILE__, __LINE__); return 1;
}
</pre>
        <div class="fragment" />
        <hr />
        <pre>$ /usr/lib/gcc-snapshot/bin/gcc -o main <strong>/home/user</strong>/main.c
</pre></div>
        <div class="fragment" />
        <pre>$ strings main | grep ^/
/lib64/ld-linux-x86-64.so.2
<strong>/home/user</strong>/main.c
</pre></div>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <p><code>dpkg-buildflags</code> (1.19.1/Sep 2018)</p>
        <br>
        <p><code>DEB_BUILD_OPTIONS="reproducible=+fixfilepath"</code></p>
        <p>Adds <code>-ffile-prefix-map=BUILD_PATH=.</code> to default GCC flags</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Build Path Variations: The Present</h3>
        <p>macro-prefix-map is in gcc-8</p>
        <p class="fragment">... not enabled by default in dpkg-buildflags</p>
        <p class="fragment">Some buildsystems embed gcc commandline.</p>
        <p class="fragment">Some test suites rely on full paths</p>
        <p class="fragment">Only works with gcc, needs to be fixed in other tools</p>
        <p class="fragment">Simple workaround: rebuild in recorded path (testing/stable)</p>
        <p class="fragment">Ignore these issues for <em>bullseye</em></p>
      </section>
      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Build Path Variations: The Future</h3>
        <p>BUILD_PATH_PREFIX_MAP</p>
        <p>https://reproducible-builds.org/specs/build-path-prefix-map</p>
        <p class="fragment">https://wiki.debian.org/ReproducibleBuilds/GCC-build-path</p>
        <p class="fragment">Your fixes on important toolchains?</p>
      </section>

      <!-- issues in-depth -->
      <section>
        <h3>Debian is wrong</h3>
        <p>93% is a lie. We need infrastructure, processes and policies. (And testing. Currently we only have testing and a vague goal.)<p>
        <p class="fragment">With the upcoming list of bugs we
        don't want to fingerpoint at individual teams,
        instead I think we can only solve this if we as Debian
        decide we want to solve it for <em>bullseye</em>.
        <br />
        I think this is not happening because people believe
        things have been sorted out and we take care of them.
        But we are not, we can't do this alone.</p>
      </section>

      <section>
        <h3>The difference between theory and practice</h3>
        <p>93% is a lie.</p>
        <p class="fragment">54% on March 5th 2019.</p>
        <p class="fragment">31% today.</p>
        <p class="fragment">We can still improve this, though 24% (6804) of our source packages have not been uploaded nor binNMUed since December 2016.</p>
        <p class="fragment">FIXME: I'm not sure I want to / we should upload &gt;5000 source packages in the next 2 years. So mass binNMUs for the rescue?  maybe do those mass uploads to experimental first? contra: more work</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Major blockers, where to help</h3>
        <p>#869184<br>sbuild, dput, dpkg: source uploads including <code>_amd64.buildinfo</code> causes problems</p>
        <p class="fragment">#894441<br>binNMUs, mtimes and <code>rsync(1)</code> causes problems and binNMUs should be replaced by easy "no-change-except-debian/changelog-uploads"</p>
        <p class="fragment">blocker for #900837<br>release.debian.org: Mass-rebuild of packages for reproducible builds"</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3><code>.buildinfo</code> files</h3>
        <p>#862073<br>ftp.debian.org: Please POST .buildinfo files to buildinfo.debian.net</p>
        <p class="fragment">#763822<br>ftp.debian.org: please include .buildinfo file in the archive</p>
        <p class="fragment">#862538<br>security.debian.org: Please POST .buildinfo files to buildinfo.debian.net</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3><code>.buildinfo</code> files</h3>
        <p>buildinfo.debian.net</p>
        <p class="fragment">buildinfos.debian.net</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3><code>.buildinfo</code> files</h3>
        <p>buildinfo.debian.net: Allows submissions from everyone (PostgreSQL)</p>
        <p class="fragment">buildinfos.debian.net: ftp-master.d.o based view with pool structure and build date</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3><code>.buildinfo</code> files from an unofficial service?</h3>
        <p class="fragment">There should be a debian.org machine serving <code>.buildinfo</code> files to the public.</p>
        <p class="fragment">Since December 2016: 965,333 files in total, eg 118,195 amd64 related.</p>
        <p class="fragment">12 GB files, 4 GB links.</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>User-facing interface</h3>
        <p class="fragment">#863622<br> apt: warn when installing packages that are not reproducible</p>
        <p class="fragment">That would be great for bullseye, but...</p>
        <p class="fragment">The goal should be to not install nor to run unreproducible software.</p>
        <p class="fragment"><em>in-toto</em> could bring this to the next level</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>tests.reproducible-builds.org</h3>
        <p>Results saved in common database</p>
        <p><code>.json</code> for Debian, openSUSE, Arch Linux, OpenWrt, Alpine</p>
        <p class="fragment">shared notes, cross distro links</p>
        <p class="fragment">Two kinds of tests: CI tests (like we have now) and tests against what's on "ftp.(debian|archlinux|...).org"</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Debian <em>stretch</em></h3>
        <p>The "reproducible in theory but not in practice" release</p>
        <h3>Debian <em>buster</em></h3>
        <p>The "we could be reproducible but we are not" release</p>
        <h3>Debian <em>bullseye</em></h3>
        <p>The "we are almost there but still haven't sorted out..." release?</p>
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="90% 10%">
        <h3>Debian <em>bullseye</em></h3>
        <p>The release is still far away and we haven't frozen yet!</p>
        <p><em>Ride like the wind, bullseye</em></p>
        <img class="fragment" src="images/hc_fdroid_fosdem16-idea.png" width="584">
      </section>

      <section data-background="images/800px-Debconf19-horizontal.png" data-background-size="8%" data-background-position="50% 15%">
        <br>
        <br>
        <br>
        <br>
        <h3>
          Thank you and to all the contributors out there!
        </h3>
        <br>
        <br>
        <h4>
          Vagrant Cascadian &bull; Chris Lamb &bull; Holger Levsen
        </h4>
      </section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
  <script>
    Reveal.initialize({
      controls: false,
      progress: false,
      history: true,
      keyboard: {
        13: 'next',
        38: 'next',
         9: 'prev',
        40: 'prev'
      }
    });
  </script>
</body>
</html>
